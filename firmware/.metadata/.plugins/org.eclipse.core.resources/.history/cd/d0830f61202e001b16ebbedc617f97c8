/*
 * as5048a_test.cc
 *
 *  Created on: Nov 23, 2020
 *      Author: jkailimcnelly
 */

#include "test_framework.hh"
#include "encoder.hh"

void TestEncoderCreate() {
	TESTPRINT("Create Encoder\r\n");
	SPI_HandleTypeDef * dummy_spi = NULL;
	AS5048A enc = AS5048A(dummy_spi);

	if (enc.get_angle() != 0) {
		FAILPRINT("Initialized with nonzero encoder angle\r\n");
	}
}

void TestEncoderZero() {
	TESTPRINT("Zero Encoder\r\n");
	SPI_HandleTypeDef * dummy_spi = NULL;
	AS5048A enc = AS5048A(dummy_spi);

	TTESTPRINT("Test negative relative angle.\r\n");
	enc.set_zero_angle(55); // set zero angle to 55 degrees
	uint16_t angle = enc.get_angle();
	if (angle != 360-55) {
		TFAILPRINT("Expected angle to be %d but got %d\r\n", 360-55, angle);
	}

	TTESTPRINT("Test setting zero angle too large.\r\n");
	enc.set_zero_angle(3600);
	angle = enc.get_angle();
	if (angle != 0) {
		TFAILPRINT("Expected angle to be %d but got %d\r\n", 0, angle);
	}
}

void TestEncoderAll() {
	LPRINT("Test Encoder Class");
	TestEncoderCreate();
	TestEncoderZero();
}

