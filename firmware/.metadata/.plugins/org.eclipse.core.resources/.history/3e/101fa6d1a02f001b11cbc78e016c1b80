/*
 * encoder.cc
 *
 *  Created on: Nov 23, 2020
 *      Author: jkailimcnelly
 */

#include "encoder.hh"
#include <math.h>

/**
 * @brief Helper function that wraps an angle into the range 0-360 degrees.
 * @param[in] angle Angle value to be wrapped (float, degrees).
 * @retval Wrapped value, in degrees.
 */
float WrapAngle(float raw_angle) {
	return value - value * floor(value / max);
}

/**
 * @brief Sets the current absolute encoder angle (degrees) as the zero position.
 */
void Encoder::set_zero_angle() {
	zero_angle_ = angle_;
}

/**
 * @brief Sets the encoder zero position to a specific value.
 * @param[in] new_zero_angle The new zero position of the encoder, in degrees.
 */
void Encoder::set_zero_angle(float new_zero_angle) {
	zero_angle_ = fmod(new_zero_angle, 360);
	if (zero_angle_ < 0) {
		zero_angle_ = 360.0 - zero_angle_;
	}
}

/**
 * @brief Returns the current angle of the encoder, in degrees.
 * @retval Angle of the encoder, in degrees.
 */
float Encoder::get_angle() {
	float rel_angle = angle_ - zero_angle_;
	if (rel_angle < 0) {
		return 360.0 - rel_angle;
	}
	return rel_angle;
//	if (angle_ >= zero_angle_) {
//		return angle_ - zero_angle_;
//	} else {
//		return 360.0 - zero_angle_ - angle_;
//	}

}

/**
 * @brief Sets the angle (in degrees) stored by the Encoder object. Takes care of wrapping to store the value
 * between 0-360.
 * @param[in] angle Angle value in degrees (float).
 */
void Encoder::set_angle(float angle) {
	float new_angle = fmod(angle, 360);
	if (new_angle < 0) {
		new_angle += 360;
	} else if (new_angle > 360) {
		new_angle -= 360;
	}
	angle_ = new_angle;
}
